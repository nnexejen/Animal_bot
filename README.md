# Animal Bot
- [Введение](#введение)
- [Функционал проекта](#функционал-проекта)
- [Используемые технологии](#используемые-технологии)
- [Запуск приложения](#запуск-приложения)
    - [Получение токена](#получение-токена)
    - [Развёртывание приложения](#развёртывание-приложения)
    - [Поиск и устранение неполадок](#поиск-и-устранение-неполадок)

## Введение
Проект animal_bot представляет из себя телеграм-бот для отправки изображений в ответ на введенную команду. В данном примере предлагается схема запуска бота при помощи Docker и Kubernetes.

## Функционал проекта:
Пользователю доступны три команды: ```/start```, ```/newcat```, ```/newdog```. Команда ```/start``` запускает бот и отправляет приветствие пользователю с обращением по имени. Далее в ответ на запрос ```/newcat```или ```/newdog``` бот присылает случайное изображение соответствующего животного. Изображения берутся из API, заданных в файле ```cm.yaml```. В логах приложения уровня INFO выводится url изображения и имя пользователя, которому оно было отправлено.

## Используемые технологии
При создании и разворачивании приложения использовались следующие технологии:
- ```python 3.9```
- ```python-telegram-bot 13.12```
- ```requests 2.28.0```
- ```docker```
- ```kubernetes```

## Запуск приложения

### Получение токена
1. В Telegram найдите бот **@BotFather** и запустите его командой ```/start```
2. Создайте нового бота командой ```/newbot```. Задайте название вашего бота и имя пользователя после соответствующих приглашений. 
Если всё прошло успешно, вы увидите приветственный текст, содержащий ссылку на вашего нового бота и токен.
3. Скопируйте токен и вставьте в файл ```secret.yaml``` вместо шаблона **123**. Сохраните файл. 

### Развёртывание приложения
1. Откройте терминал в директории с файлами проекта.
2. Выполните команду для сборки образа:
```
docker build -t animal-bot:latest .
```

или спулльте [готовый образ с Docker Hub](https://hub.docker.com/r/buv12/animal-bot).

3. Примените манифесты:
```
kubectl apply -f cm.yaml -f secret.yaml -f deployment.yaml
```

4. Откройте Telegram, найдите вашего бота и протестируйте команды ```/start```, ```/newcat```, ```/newdog```.

### Поиск и устранение неполадок
- Проверьте, что поды запущены:
```
kubectl get pods
```
Вы должны увидеть под с именем, начинающимся на ```animal-bot-deployment```.

- Просмотрите логи пода:
```
kubectl logs -l app=animal-bot
```
- При необходимости удалите деплоймент:
```
kubectl delete -f deployment.yaml
```
- После этого повторите пункты 3-4 из раздела [Развёртывание приложения](#развёртывание-приложения).

