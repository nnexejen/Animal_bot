# Animal Bot
- [Введение](#введение)
- [Функционал проекта](#функционал-проекта)
- [Используемые технологии](#используемые-технологии)
- [Запуск приложения](#запуск-приложения)
    - [Получение токена](#получение-токена)
    - [Развёртывание приложения](#развёртывание-приложения)
    - [Поиск и устранение неполадок](#поиск-и-устранение-неполадок)

## Введение
Проект animal_bot представляет из себя телеграм-бот для отправки изображений в ответ на введенную команду. В данном примере предлагается схема запуска бота при помощи менеджера пакетов для Kubernetes Helm Charts.

## Функционал проекта:
Пользователю доступны три команды: ```/start```, ```/newcat```, ```/newdog```. Команда ```/start``` запускает бот и отправляет приветствие пользователю с обращением по имени. Далее в ответ на запрос ```/newcat```или ```/newdog``` бот присылает случайное изображение соответствующего животного. Изображения берутся из API, заданных в разделе ```configMap``` файла ```values.yaml```. В логах приложения уровня INFO выводится url изображения и имя пользователя, которому оно было отправлено.

## Используемые технологии
При создании и разворачивании приложения использовались следующие технологии:
- ```python 3.9```
- ```python-telegram-bot 13.12```
- ```requests 2.28.0```
- ```docker```
- ```kubernetes```
- ```helm chart```

## Запуск приложения

### Получение токена
1. В Telegram найдите бот **@BotFather** и запустите его командой ```/start```
2. Создайте нового бота командой ```/newbot```. Задайте название вашего бота и имя пользователя после соответствующих приглашений. 
Если всё прошло успешно, вы увидите приветственный текст, содержащий ссылку на вашего нового бота и токен.
3. Скопируйте токен и вставьте в раздел ```secret``` файла ```values.yaml``` вместо шаблона **123**. Сохраните файл. 

### Развёртывание приложения
1. Откройте терминал в директории с файлами проекта.
2. Выполните команду для сборки образа:
```
docker build -t animal-bot:latest .
```

или спулльте [готовый образ с Docker Hub](https://hub.docker.com/r/buv12/animal-bot).

3. Установите чарт:
```
helm install animal-bot-release ./animal-bot-chart
```

4. Откройте Telegram, найдите вашего бота и протестируйте команды ```/start```, ```/newcat```, ```/newdog```.

### Поиск и устранение неполадок
- Проверьте созданные ресурсы:
```
kubectl get deployments
kubectl get secrets
kubectl get configmaps
kubectl get pods
```
- Просмотрите логи пода:
```
kubectl logs -l app=animal-bot
```
- Обновите чарт, если изменились параметры:
```
helm upgrade animal-bot-release ./animal-bot-chart
```
- При необходимости удалите релиз:
```
helm uninstall animal-bot-release
```
- После этого повторите пункты 3-4 из раздела [Развёртывание приложения](#развёртывание-приложения).

