# Animal Bot
- [Введение](#введение)
- [Функционал проекта](#функционал-проекта)
- [Используемые технологии](#используемые-технологии)
- [Переменные окружения](#переменные-окружения)
- [Запуск приложения](#запуск-приложения)
    - [Получение токена](#получение-токена)
    - [Развёртывание приложения при помощи Docker](#развёртывание-приложения-при-помощи-docker)
    - [Поиск и устранение неполадок](#поиск-и-устранение-неполадок)

## Введение
Проект animal_bot представляет из себя телеграм-бот для отправки изображений в ответ на введенную команду. В данном примере предлагается схема запуска бота при помощи чистого Docker.

## Функционал проекта:
Пользователю доступны три команды: ```/start```, ```/newcat```, ```/newdog```. Команда ```/start``` запускает бот и отправляет приветствие пользователю с обращением по имени. Далее в ответ на запрос ```/newcat```или ```/newdog``` бот присылает случайное изображение соответствующего животного. Изображения берутся из API, заданных переменными из раздела "Переменные окружения". В логах приложения уровня INFO выводится url изображения и имя пользователя, которому оно было отправлено.

## Используемые технологии
При создании и разворачивании приложения использовались следующие технологии:
- ```python 3.9```
- ```python-telegram-bot 13.12```
- ```requests 2.28.0```
- ```docker```

## Переменные окружения
В директории infra репозитория находится файл ```all.env```, содержащий следующие переменные окружения:\
```TOKEN``` - секретный токен для телеграмм-канала\
```CAT_URL``` - адрес API для поиска ссылок на котиков, по умолчанию https://api.thecatapi.com/v1/images/search
```DOG_URL``` - адрес API для поиска ссылок на собак, по умолчанию https://api.thedogapi.com/v1/images/search

## Запуск приложения

### Получение токена
1. В Telegram найдите бот **@BotFather** и запустите его командой ```/start```
2. Создайте нового бота командой ```/newbot```. Задайте название вашего бота и имя пользователя после соответствующих приглашений. 
Если всё прошло успешно, вы увидите приветственный текст, содержащий ссылку на вашего нового бота и токен.
3. Скопируйте токен и вставьте в файл ```infra/all.env``` вместо шаблона **123**. Сохраните файл. 

### Развёртывание приложения при помощи Docker
1. Откройте терминал в директории с файлами проекта.
2. Выполните команду для сборки образа:
```
docker build -t animal-bot:latest .
```
```-t animal-bot:latest``` задаёт имя и тег образа.
```.``` указывает на текущую директорию, где находится Dockerfile.

3. Запустите контейнер:
```
docker run --env-file infra/all.env -d --name animal_bot animal-bot:latest
```
```--env-file infra/all.env``` передаёт переменные окружения из файла ```infra/all.env```.
```-d``` запускает контейнер в фоновом режиме.
```--name animal_bot``` задаёт имя контейнера.
```animal-bot:latest``` — имя образа.

4. Откройте Telegram, найдите вашего бота и протестируйте команды ```/start```, ```/newcat```, ```/newdog```.

### Поиск и устранение неполадок
- Проверьте, что контейнер работает:
```
docker ps
```
Вы должны увидеть контейнер ```animal_bot``` в списке.

- Просмотрите логи для проверки работы бота:
```
docker logs animal_bot
```
При нормальном старте бота первая строка лога будет иметь вид 
<дата> <время> - apscheduler.scheduler - INFO - Scheduler started:
```
2025-07-25 18:28:53,487 - apscheduler.scheduler - INFO - Scheduler started
```
При наличии проблем лог будет содержать Traceback с описанием ошибок или сообщения уровня ERROR. Например:
```
Traceback (most recent call last):
  ...
  File "/usr/local/lib/python3.9/site-packages/telegram/bot.py", line 358, in _validate_token
    raise InvalidToken()
telegram.error.InvalidToken: Invalid token
```
- При необходимости внесите изменения и пересоберите контейнер. Для этого:
    - Остановите контейнер: 
    ```
    docker stop animal_bot
    ```
    - Удалите контейнер: 
    ```
    docker rm animal_bot
    ```
    - Удалите образ (если нужно): 
    ```
    docker rmi animal-bot:latest
    ```
    - После этого повторите пункты 2-4 из раздела [Развёртывание приложения](#развёртывание-приложения-при-помощи-docker).

